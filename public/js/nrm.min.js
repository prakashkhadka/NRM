(function(){angular.module("roomApp",["ngRoute","ngAutocomplete","ngFileUpload"]);angular.module("roomApp").controller("indexController",["$anchorScroll",o]);function o(o){o()}})();(function(){angular.module("roomApp").controller("homeCtrl",["$scope","$http","$anchorScroll",o]);function o(o,e,r){r();e({method:"GET",url:"/api/rooms"}).then(function e(r){o.rooms=r.data},function e(r){o.error=r.data});o.getRooms=function(r){o.showButton=true;o.count=[];o.count.push(r);e({method:"GET",url:"/api/roomsByPage/"+r}).then(function e(r){o.moreRooms=r.data},function e(r){o.error=r.data})}}})();(function(){angular.module("roomApp").config(["$routeProvider","$locationProvider",o]);function o(o,e){e.html5Mode(true);o.when("/forgetPassword",{templateUrl:"auth/forgetPassword/forgetPassword/forgetPasswordTemplate.html",controller:"forgetPasswordCtrl"}).when("/resetForgottonPassword/:receivedToken",{templateUrl:"auth/forgetPassword/resetForgottonPassword/resetForgottonPwdTemplate.html",controller:"resetForgottonPwdCtrl"}).when("/changePassword",{templateUrl:"auth/changePassword/changePassword/changePasswordTemplate.html",controller:"changePasswordCtrl"})}})();(function(){angular.module("roomApp").config(["$routeProvider","$locationProvider",o]);function o(o,e){e.html5Mode(true);o.when("/",{templateUrl:"home/home.html",controller:"homeCtrl"}).when("/roomDetail/:roomid",{templateUrl:"roomDetail/roomDetails.html",controller:"roomDetailCtrl"}).when("/createRoom",{templateUrl:"createRoom/createRoom.view.html",controller:"createRoomCtrl"}).when("/editRoom/:roomid",{templateUrl:"editRoom/editRoom.html",controller:"editRoomCtrl"}).when("/roomPagination",{templateUrl:"roomPagination/roomPagination.html",controller:"roomPaginationCtrl"}).when("/searchResult",{templateUrl:"searchResult/searchResult.html",controller:"searchCtrl"}).otherwise({redirectTo:"/"})}})();(function(){angular.module("roomApp").config(["$routeProvider","$locationProvider",o]);function o(o,e){e.html5Mode(true);o.when("/login",{templateUrl:"auth/login/login.html",controller:"loginCtrl"}).when("/register",{templateUrl:"auth/register/register.html",controller:"registerCtrl"}).when("/logout",{templateUrl:"auth/logout/logout.html",controller:"logoutCtrl"}).when("/dashboard",{templateUrl:"dashboard/dashboard.html",controller:"myPostCtrl"}).when("/myPost",{templateUrl:"myPost/myPostTemplate.html",controller:"myPostCtrl"})}})();(function(){angular.module("roomApp").directive("navigation",o);function o(){return{restrict:"EA",templateUrl:"directives/navigation/navigationView.html",controller:"navigationCtrl"}}})();(function(){angular.module("roomApp").controller("navigationCtrl",["$scope","$location","authentication",o]);function o(o,e,r){o.currentPath=e.path();o.isLoggedIn=r.isLoggedIn();o.currentUser=r.currentUser();o.logout=function(){r.logout();o.isLoggedIn=false;e.path("/")}}})();(function(){angular.module("roomApp").directive("searchRoom",o);function o(){return{restrict:"EA",templateUrl:"directives/search/searchView.html",controller:"searchCtrl"}}})();angular.module("roomApp").controller("searchCtrl",["$scope","$http","$location","$rootScope",searchCtrl]);function searchCtrl(o,e,r,t){o.addressSearch=function(a){var n=[{fullName:"Western Australia",alias:"WA"},{fullName:"South Australia",alias:"SA"},{fullName:"Tasmania",alias:"TAS"},{fullName:"Victoria",alias:"VIC"},{fullName:"Queensland",alias:"QLD"},{fullName:"New South Wales",alias:"NSW"},{fullName:"Australian Capital Territorry",alias:"ACT"},{fullName:"Northern Territorry",alias:"NT"}];var l=a.searchValue;var i=l.trim();var s=new RegExp("\\b\\d{4}\\b");var u=i.match(s);if(u!==null){var u=u[0];i=i.replace(u[0],"")}if(i.length>0){for(var c=0;c<n.length;c++){var d=new RegExp("\\b("+n[c].alias+"|"+n[c].fullName+")\\b","ig");var m=i.match(d);if(m!==null){m=n[c].alias;i=i.replace(n[c].fullName,"");i=i.replace("Australia","");break}}}if(i.length>0){var f=new RegExp("[^a-zA-Z\\-\\s]","g");var h=i.replace(f,"").trim()}var p={postCode:u,state:m,suburb:h};console.log("Search data : ");console.log(p);e({method:"POST",url:"/api/roomSearch",data:p}).success(function(e){r.path("/searchResult");t.searchedRoom=e;console.log("Search data received from server : ");console.log(o.searchedRoom)}).error(function(o){})}}(function(){angular.module("roomApp").directive("footerGeneric",o);function o(){return{restrict:"EA",templateUrl:"directives/footer/footerView.html",controller:"footerCtrl"}}})();(function(){angular.module("roomApp").controller("footerCtrl",["$scope","$http","$window","$anchorScroll",o]);function o(o,e,r,t){o.sendMessage=function(o){e({method:"POST",url:"/api/contactUs",data:o}).then(function(o){$("#contactUSModal").modal("show")},function(o){})};o.closeContactUsModal=function(){t();r.location.reload()}}})();(function(){"use strict";angular.module("roomApp").directive("feedback",o);function o(){return{restrict:"EA",replace:true,templateUrl:"directives/feedback/feedbackTemplate.html",scope:{isActionCompleted:"@",feedbackMessage:"@"}}}})();(function(){angular.module("roomApp").controller("roomPaginationCtrl",["$scope","$http","$anchorScroll",o]);function o(o,e,r){r();e({method:"GET",url:"/api/roomsByPage/"+1}).then(function e(r){o.rooms=r.data;o.currentPage=1},function e(r){o.error=r.data});o.getRooms=function(r){o.currentPage=r;e({method:"GET",url:"/api/roomsByPage/"+r}).then(function e(r){o.rooms=r.data;o.showMore=true;if(o.rooms.length===0){o.endOfPage=true}},function e(r){o.error=r.data})};o.forward=function(){r();value=o.currentPage+1;o.currentPage=value;e({method:"GET",url:"/api/roomsByPage/"+value}).then(function e(r){o.rooms=r.data;if(o.rooms.length===0){o.endOfPage=true}},function e(r){o.error=r.data})};o.backward=function(){r();var t=o.currentPage-1;o.currentPage=t;e({method:"GET",url:"/api/roomsByPage/"+t}).then(function e(r){o.rooms=r.data;if(o.rooms.length>0){o.endOfPage=false}},function e(r){o.error=r.data})}}})();(function(){angular.module("roomApp").controller("forgetPasswordCtrl",["$scope","$http","$location","$anchorScroll",o]);function o(o,e,r,t){t();o.forgetPassword=function(o){e({method:"POST",url:"/api/forgottonPassword",data:o})};o.forgetPasswordFeedbackCloseBtn=function(){$(".modal-backdrop").remove();r.path("/home")}}})();(function(){angular.module("roomApp").controller("resetForgottonPwdCtrl",["$scope","$http","$location","$routeParams","authentication","$anchorScroll","$timeout",o]);function o(o,e,r,t,a,n,l){n();o.receivedToken=t.receivedToken;o.change=function(t){if(o.newPassword.newPassword1!==o.newPassword.newPassword2){o.passwordError="Both Password should match";return}else{var n={token:o.receivedToken,newPassword:o.newPassword};e({method:"POST",url:"/api/doReset",data:n}).then(function e(t){a.saveToken(t.data.token);o.isForgottonPasswordReset=true;o.feedbackMessage="Congratulations ! Your password is changed.";$("#feedback-modal").modal("show");l(function(){$(".modal-backdrop").remove();r.path("/dashboard")},2e3)},function e(r){o.message="Could not reset your password"})}}}})();(function(){angular.module("roomApp").controller("changePasswordCtrl",["$scope","$location","$http","authentication","$anchorScroll","$timeout",o]);function o(o,e,r,t,a,n){if(!t.isLoggedIn()){e.path("/login")}a();o.changePassword=function(a){var l=t.isLoggedIn();if(a.newPassword!==a.confirmPassword){o.errorMessage="Both password should match"}else if(!l){o.errorMessage("You must be loggedIn to change password.")}else{var i=t.currentUser();var s=i.email;var u={pwd:a,userEmail:s};r({method:"POST",url:"/api/changePassword",data:u,headers:{Authorization:"Bearer "+t.getToken()}}).then(function(r){o.isPasswordChanged=true;o.feedbackMessage="Your password is successfully changed.";$("#feedback-modal").modal("show");n(function(){$(".modal-backdrop").remove();e.path("/dashboard")},1500)},function(e){o.errorMessage="Something went wrong. Please try again."})}}}})();(function(){angular.module("roomApp").service("roomData",["$http",o]);function o(o){var e=function(){return o.get("/api/rooms")};var r=function(e){return o.get("/api/rooms/"+e)};var t=function(e){return o.post("/api/rooms",e)};var a=function(e){return o.get("/api/myRoom/"+e)};return{rmData:e,roomDetail:r,createRoom:t,myRoom:a}}})();(function(){angular.module("roomApp").service("authentication",["$http","$window",o]);function o(o,e){var r=function(o){e.localStorage["room-token"]=o};var t=function(){return e.localStorage["room-token"]};var a=function(){var o=t();if(o){var r=JSON.parse(e.atob(o.split(".")[1]));return r.exp>Date.now()/1e3}else{return false}};var n=function(){if(a()){var o=t();var r=JSON.parse(e.atob(o.split(".")[1]));return{email:r.email,name:r.firstName}}};register=function(e){return o.post("/api/register",e).success(function(o){r(o.token)})};login=function(e){return o.post("/api/login",e).success(function(o){r(o.token)})};logout=function(){e.localStorage.removeItem("room-token")};return{currentUser:n,saveToken:r,getToken:t,isLoggedIn:a,register:register,login:login,logout:logout}}})();(function(){angular.module("roomApp").controller("roomDetailCtrl",["$http","$routeParams","$scope","roomData","$anchorScroll","$location","$timeout",o]);function o(o,e,r,t,a,n,l){a();r.roomid=e.roomid;t.roomDetail(r.roomid).success(function(o){r.oneRoomDetails=o;r.ORD=r.oneRoomDetails}).error(function(o){});r.sendEmailToOwner=function(e){var t=r.ORD.email;var a=r.ORD._id;var i={emailToOwner:e,roomId:a,ownerEmail:t};o({method:"POST",url:"/api/sendEmailToOwner",data:i}).then(function(o){r.isSent=true;r.feedbackMessage="Your message is sent to the owner.";$("#feedback-modal").modal("show");l(function(){$(".modal-backdrop").remove();n.path("/")},2e3)},function(o){})}}})();(function(){angular.module("roomApp").controller("createRoomCtrl",["$location","$scope","$http","authentication","$anchorScroll","$timeout","authentication",o]);function o(o,e,r,t,a,n,t){a();if(!t.isLoggedIn()){o.path("/login")}e.availableOptions={availableBROptions:[1,2,3,4,5],availableBillsOption:["included","excluded"],availableGenderOption:["Couple","Female","Male","No preferred gender"],availableFurnishingOption:["Fully-furnished","semi-furnished","Not furnished"],availableParkingOption:["Locked garage","Driveway","Compound","Street","Not Available"],availablePropertyOption:["Apartment","House"],availableBathroomOption:[1,2,3]};e.room={totalBedRooms:2,bills:"included",gender:"Couple",furnishing:"Fully-furnished",parking:"Street",propertyType:"Apartment",totalBathrooms:1};e.beforeChange=function(){e.compressing=true};e.afterChange=function(){e.compressing=false};e.deleteFile=function(o){e.files.splice(o,1)};e.getValue=function(){var o=[];r({method:"GET",url:"js/subs.json"}).success(function(r){for(var t=0;t<r.subs.length;t++){var a=r.subs[t].suburb;var n=r.subs[t].postcode;var l=r.subs[t].state;o.push([a,n,l]);e.returnedSub=o}})};e.AssignValueAndHide=function(o){e.room.suburb=o[0];e.room.postcode=o[1];e.room.state=o[2];e.returnedSub=[]};e.getAmazonUrl=function(){var o=[];var a=[];for(var n=0;n<e.files.length;n++){o.push(Date.now()+n+".jpg");a.push(e.files[n].type)}r({url:"/api/amazonUrl",method:"POST",data:{filename:o,type:a},headers:{Authorization:"Bearer "+t.getToken()}}).then(function(o){e.urls=o.data});e.imageName=o};e.uploadImage=function(){for(var o=0;o<e.urls.length;o++){r({method:"PUT",url:e.urls[o],data:e.files[o],headers:{"Content-Type":e.files[o].type}}).then(function(o){},function(o){})}};e.register=function(o){e.room.imgName=e.imageName;createRoom(o)};createRoom=function(a){r({method:"POST",url:"/api/rooms",data:a,headers:{Authorization:"Bearer "+t.getToken()}}).then(function(r){e.isPosted=true;e.feedbackMessage="Congratulations! You have successfully listed your room";$("#feedback-modal").modal("show");n(function(){$(".modal-backdrop").remove();o.path("/myPost")},2e3)},function(o){e.errorMessage=o.data},function(o){e.progressPercentage=Math.min(100,parseInt(100*o.loaded/o.total))})};e.close=function(){o.path("/myPost")};e.goHome=function(){o.path("/dashboard")}}})();angular.module("roomApp").filter("startsWithLetter",function(){return function(o,e){var r=[];var t=new RegExp(e,"i");for(var a=0;a<o.length;a++){var n=o[a];if(t.test(n.name.substring(0,1))){r.push(n)}}return r}});(function(){angular.module("roomApp").controller("editRoomCtrl",["$location","$scope","$http","$routeParams","authentication","$anchorScroll","$timeout",o]);function o(o,e,r,t,a,n,l){var i=a.currentUser().email;if(!a.isLoggedIn()){o.path("/login")}n();var s=t.roomid;r({method:"GET",url:"/api/editRoom/",params:{roomid:s,userEmail:i},headers:{Authorization:"Bearer "+a.getToken()}}).then(function(o){console.log(o.data);e.room=o.data},function(o){});e.availableOptions={availableBROptions:[1,2,3,4,5],availableBillsOption:["included","excluded"],availableGenderOption:["Couple","Female","Male","No preferred gender"],availableFurnishingOption:["Fully-furnished","semi-furnished","Not furnished"],availableParkingOption:["Locked garage","Driveway","Compound","Street","Not Available"],availablePropertyOption:["Apartment","House"],availableBathroomOption:[1,2,3]};e.update=function(t){var n={room:t,userEmail:i};r.put("/api/rooms/"+t._id,n,{headers:{Authorization:"Bearer "+a.getToken()}}).then(function(r){e.isEdited=true;e.feedbackMessage="Your room is successfully edited. Your post will appear soon.";$("#feedback-modal").modal("show");l(function(){$(".modal-backdrop").remove();o.path("/myPost")},3e3)},function(o){})};e.goHome=function(){o.path("/dashboard")}}})();(function(){angular.module("roomApp").controller("loginCtrl",["$scope","$location","authentication","$anchorScroll",o]);function o(o,e,r,t){t();o.login=function(t){if(!t.email||!t.password){o.loginError="All fields required, please enter both fields"}r.login(t).success(function(){e.path("/dashboard")}).error(function(e){o.loginError="Incorrect email or password."})}}})();(function(){angular.module("roomApp").controller("registerCtrl",["$location","$scope","authentication","$http","$anchorScroll","$timeout",o]);function o(o,e,r,t,a,n){a();e.validateEmail=function(o){t({method:"POST",url:"/api/validateEmail",data:o}).then(function o(r){e.emailError=r.data},function o(e){})};e.hideError=function(){e.emailError=undefined};e.checkTwoPwd=function(){if(e.newUser.password!==e.newUser.password1){e.pwdMatchError="Password does not match"}};e.removePwdMatchError=function(){e.pwdMatchError=undefined};e.register=function(t){if(t.password===t.password1&&t.tandc===true){r.register(t).success(function(r){e.isRegistered=true;e.feedbackMessage="Congratulation ! You are successfully registered.";$("#feedback-modal").modal("show");n(function(){$(".modal-backdrop").remove();o.path("/dashboard")},2e3)},function(o){e.errorMessage=o})}}}})();(function(){angular.module("roomApp").controller("myPostCtrl",["$scope","$http","$location","authentication","$anchorScroll","$timeout","$window",o]);function o(o,e,r,t,a,n,l){if(!t.isLoggedIn()){r.path("/login")}a();o.isDeleted=false;var i=t.currentUser();var s=i.email;e.get("/api/myRoom/"+s,{headers:{Authorization:"Bearer "+t.getToken()}}).success(function(e){o.roomsByUser=e;for(var r=0;r<e.length;r++){o.usersRoom=e[r]}},function(o){});o.confirm=function(e){o.confirmedRoomId=e;$("#confirmation-modal").modal("show")};o.remove=function(a){$("#confirmation-modal").modal("hide");e({method:"GET",url:"/api/removeRoom/"+a,headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){o.isDeleted=true;o.feedbackMessage="Successfully removed.";$("#feedback-modal").modal("show");n(function(){$("#feedback-modal").modal("hide");$(".modal-backdrop").remove();l.location.reload()},2e3)},function e(t){o.isDeleted=false;o.feedbackMessage="Sorry, somehing went wrong.Try again.";$("#feedback-modal").modal("show");n(function(){$(".modal-backdrop").remove();r.path("/myPost")},2e3)})}}})();